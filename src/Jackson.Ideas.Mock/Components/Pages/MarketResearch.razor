@page "/market-research"
@using Jackson.Ideas.Mock.Services.Interfaces
@using Jackson.Ideas.Mock.Models
@inject IMarketResearchService MarketResearchService
@inject IMockDataService MockDataService
@inject NavigationManager Navigation

<PageTitle>Market Research - Ideas Matter Demo</PageTitle>

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-1">Market Research Analysis üìà</h1>
                    <p class="text-muted">Comprehensive market data and competitive insights</p>
                </div>
                <button class="btn btn-primary" @onclick="NavigateToDashboard">
                    ‚Üê Back to Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- Scenario Selector -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="mb-3">Select Business Scenario</h5>
                    <div class="row">
                        @foreach (var scenario in scenarios.Take(6))
                        {
                            <div class="col-md-2 mb-2">
                                <button class="btn @(selectedScenarioId == scenario.Id ? "btn-primary" : "btn-outline-primary") btn-sm w-100" 
                                        @onclick="() => SelectScenario(scenario.Id)">
                                    @scenario.Name
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (marketData != null)
    {
        <!-- Market Segmentation -->
        <div class="row mb-4">
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üéØ Market Segmentation</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Total Market Size</span>
                                <span class="fw-bold">@marketData.Segmentation.TotalMarketSize</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Serviceable Market</span>
                                <span class="fw-bold">@marketData.Segmentation.ServicableMarketSize</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Target Market</span>
                                <span class="fw-bold text-success">@marketData.Segmentation.TargetMarketSize</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Growth Rate</span>
                                <span class="fw-bold text-success">@marketData.Segmentation.GrowthRate</span>
                            </div>
                        </div>

                        <h6>Market Segments:</h6>
                        @foreach (var segment in marketData.Segmentation.Segments)
                        {
                            <div class="card mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title small mb-1">@segment.Name</h6>
                                    <p class="card-text small text-muted mb-1">@segment.Demographics</p>
                                    <div class="d-flex justify-content-between">
                                        <small class="text-success">@segment.Size</small>
                                        <small class="text-info">@segment.PurchasingPower</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Competitive Analysis -->
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">‚öîÔ∏è Competitive Analysis</h5>
                    </div>
                    <div class="card-body">
                        <h6>Direct Competitors:</h6>
                        @foreach (var competitor in marketData.Competition.DirectCompetitors)
                        {
                            <div class="card mb-3">
                                <div class="card-body p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">@competitor.Name</h6>
                                        <span class="badge bg-warning text-dark">@competitor.MarketShare</span>
                                    </div>
                                    <p class="small text-success mb-1"><strong>Strengths:</strong> @competitor.Strengths</p>
                                    <p class="small text-danger mb-1"><strong>Weaknesses:</strong> @competitor.Weaknesses</p>
                                    <p class="small mb-1"><strong>Pricing:</strong> @competitor.PricingStrategy</p>
                                    <p class="small text-info mb-0"><strong>Differentiation:</strong> @competitor.DifferentiationFactor</p>
                                </div>
                            </div>
                        }

                        <h6 class="mt-3">Competitive Advantages:</h6>
                        <ul class="small">
                            @foreach (var advantage in marketData.Competition.CompetitiveAdvantages)
                            {
                                <li class="text-success">@advantage</li>
                            }
                        </ul>

                        <h6 class="mt-3">Market Gaps:</h6>
                        <ul class="small">
                            @foreach (var gap in marketData.Competition.MarketGaps)
                            {
                                <li class="text-primary">@gap</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Market Trends -->
            <div class="col-lg-4">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üìä Market Trends</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong>Market Maturity:</strong>
                            <p class="small">@marketData.Trends.MarketMaturity</p>
                        </div>

                        <h6>Emerging Trends:</h6>
                        <ul class="small mb-3">
                            @foreach (var trend in marketData.Trends.EmergingTrends)
                            {
                                <li>@trend</li>
                            }
                        </ul>

                        <h6>Technology Trends:</h6>
                        <ul class="small mb-3">
                            @foreach (var trend in marketData.Trends.TechnologyTrends)
                            {
                                <li>@trend</li>
                            }
                        </ul>

                        <h6>Consumer Behavior:</h6>
                        <ul class="small mb-3">
                            @foreach (var trend in marketData.Trends.ConsumerBehaviorTrends)
                            {
                                <li>@trend</li>
                            }
                        </ul>

                        <h6>Regulatory Trends:</h6>
                        <ul class="small">
                            @foreach (var trend in marketData.Trends.RegulatoryTrends)
                            {
                                <li>@trend</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Insights & Regulatory Environment -->
        <div class="row">
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üë• Customer Insights</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Pain Points:</h6>
                                <ul class="small mb-3">
                                    @foreach (var point in marketData.Customer.PainPoints)
                                    {
                                        <li class="text-danger">@point</li>
                                    }
                                </ul>

                                <h6>Motivations:</h6>
                                <ul class="small mb-3">
                                    @foreach (var motivation in marketData.Customer.Motivations)
                                    {
                                        <li class="text-success">@motivation</li>
                                    }
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Preferred Channels:</h6>
                                <ul class="small mb-3">
                                    @foreach (var channel in marketData.Customer.PreferredChannels)
                                    {
                                        <li>@channel</li>
                                    }
                                </ul>

                                <div class="mb-2">
                                    <strong>Purchase Decision Factors:</strong>
                                    <p class="small">@marketData.Customer.PurchaseDecisionFactors</p>
                                </div>

                                <div class="mb-2">
                                    <strong>Customer LTV:</strong>
                                    <p class="small text-success">@marketData.Customer.CustomerLifetimeValue</p>
                                </div>

                                <div>
                                    <strong>Acquisition Cost:</strong>
                                    <p class="small text-warning">@marketData.Customer.AcquisitionCost</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">‚öñÔ∏è Regulatory Environment</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong>Regulatory Risk:</strong>
                            <span class="badge bg-warning text-dark">@marketData.Regulatory.RegulatoryRisk</span>
                        </div>

                        <h6>Key Regulations:</h6>
                        <ul class="small mb-3">
                            @foreach (var regulation in marketData.Regulatory.KeyRegulations)
                            {
                                <li>@regulation</li>
                            }
                        </ul>

                        <h6>Compliance Requirements:</h6>
                        <ul class="small mb-3">
                            @foreach (var requirement in marketData.Regulatory.ComplianceRequirements)
                            {
                                <li>@requirement</li>
                            }
                        </ul>

                        <h6>Upcoming Changes:</h6>
                        <ul class="small">
                            @foreach (var change in marketData.Regulatory.UpcomingChanges)
                            {
                                <li class="text-warning">@change</li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="row">
            <div class="col-12">
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Loading market research data...</p>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private List<BusinessIdeaScenario> scenarios = new();
    private MarketResearchData? marketData;
    private string selectedScenarioId = "";

    protected override async Task OnInitializedAsync()
    {
        scenarios = await MockDataService.GetAllScenariosAsync();
        if (scenarios.Any())
        {
            selectedScenarioId = scenarios.First().Id;
            await SelectScenario(selectedScenarioId);
        }
    }

    private async Task SelectScenario(string scenarioId)
    {
        selectedScenarioId = scenarioId;
        marketData = await MarketResearchService.GetMarketResearchAsync(scenarioId);
        StateHasChanged();
    }

    private void NavigateToDashboard()
    {
        Navigation.NavigateTo("/dashboard");
    }
}